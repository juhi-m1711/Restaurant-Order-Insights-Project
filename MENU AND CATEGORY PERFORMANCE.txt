-- MENU AND CATEGORY PERFORMANCE
-- 1. Orders Per Category
WITH BASE_ORDER AS (
	SELECT
		OD.ORDER_DETAILS_ID,
		OD.ORDER_ID,
		OD.ORDER_DATE,
		OD.ORDER_TIME,
		OD.ITEM_ID,
		MI.MENU_ITEM_ID,
		MI.ITEM_NAME,
		MI.CATEGORY,
		MI.PRICE
	FROM 
	ORDER_DETAILS AS OD
	JOIN 
	MENU_ITEMS AS MI 
	ON
	OD.ITEM_ID = MI.MENU_ITEM_ID
),
ORDER_PER_CATEGORY AS(
	SELECT 
	CATEGORY,
	COUNT(*) AS ITEMS_ORDERED
	FROM BASE_ORDER
	GROUP BY CATEGORY
)
SELECT * 
FROM ORDER_PER_CATEGORY
ORDER BY ITEMS_ORDERED DESC;

-- 2. Average Item Price Per Category
WITH BASE_ORDER AS (
	SELECT
		OD.ORDER_DETAILS_ID,
		OD.ORDER_ID,
		OD.ORDER_DATE,
		OD.ORDER_TIME,
		OD.ITEM_ID,
		MI.MENU_ITEM_ID,
		MI.ITEM_NAME,
		MI.CATEGORY,
		MI.PRICE
	FROM 
	ORDER_DETAILS AS OD
	JOIN 
	MENU_ITEMS AS MI 
	ON
	OD.ITEM_ID = MI.MENU_ITEM_ID
),
AVERAGE_ITEMS_PRICE AS(
	SELECT 
	CATEGORY,
	ROUND(AVG(PRICE)) AS AVERAGE_ITEM_PRICE_PER_CATEGORY
	FROM BASE_ORDER
	GROUP BY CATEGORY
)
SELECT * FROM AVERAGE_ITEMS_PRICE;