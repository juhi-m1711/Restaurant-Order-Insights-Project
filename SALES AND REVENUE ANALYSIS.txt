-- SALES AND REVENUE ANALYSIS
-- 1. Total Revenue Generated
WITH BASE_ORDER AS (
	SELECT
		OD.ORDER_DETAILS_ID,
		OD.ORDER_ID,
		OD.ORDER_DATE,
		OD.ORDER_TIME,
		OD.ITEM_ID,
		MI.MENU_ITEM_ID,
		MI.ITEM_NAME,
		MI.CATEGORY,
		MI.PRICE
	FROM 
	ORDER_DETAILS AS OD
	JOIN 
	MENU_ITEMS AS MI 
	ON
	OD.ITEM_ID = MI.MENU_ITEM_ID
)
SELECT 
	SUM(PRICE) AS TOTAL_REVENUE 
FROM BASE_ORDER ;

-- 2. Revenue by day
WITH BASE_ORDER AS (
	SELECT
		OD.ORDER_DETAILS_ID,
		OD.ORDER_ID,
		OD.ORDER_DATE,
		OD.ORDER_TIME,
		OD.ITEM_ID,
		MI.MENU_ITEM_ID,
		MI.ITEM_NAME,
		MI.CATEGORY,
		MI.PRICE
	FROM 
	ORDER_DETAILS AS OD
	JOIN 
	MENU_ITEMS AS MI 
	ON
	OD.ITEM_ID = MI.MENU_ITEM_ID
),
DAILY_REVENUE AS(
	SELECT ORDER_DATE, 
		SUM(PRICE) AS REVENUE
	FROM BASE_ORDER
	GROUP BY ORDER_DATE
)
SELECT * 
FROM DAILY_REVENUE
ORDER BY ORDER_DATE;

-- 3. Revenue by month
WITH BASE_ORDER AS (
	SELECT
		OD.ORDER_DETAILS_ID,
		OD.ORDER_ID,
		OD.ORDER_DATE,
		OD.ORDER_TIME,
		OD.ITEM_ID,
		MI.MENU_ITEM_ID,
		MI.ITEM_NAME,
		MI.CATEGORY,
		MI.PRICE
	FROM 
	ORDER_DETAILS AS OD
	JOIN 
	MENU_ITEMS AS MI 
	ON
	OD.ITEM_ID = MI.MENU_ITEM_ID
),
MONTHLY_REVENUE AS(
	SELECT 
	TO_CHAR(ORDER_DATE, 'YYYY-MM') AS MONTHS,
	SUM(PRICE) AS MONTHLY_REVENUE
	FROM BASE_ORDER
	GROUP BY MONTHS
)
SELECT * FROM MONTHLY_REVENUE ORDER BY MONTHS;

-- 4. Revenue by category
WITH BASE_ORDER AS (
	SELECT
		OD.ORDER_DETAILS_ID,
		OD.ORDER_ID,
		OD.ORDER_DATE,
		OD.ORDER_TIME,
		OD.ITEM_ID,
		MI.MENU_ITEM_ID,
		MI.ITEM_NAME,
		MI.CATEGORY,
		MI.PRICE
	FROM 
	ORDER_DETAILS AS OD
	JOIN 
	MENU_ITEMS AS MI 
	ON
	OD.ITEM_ID = MI.MENU_ITEM_ID
),
CATEGORY_REVENUE AS (
	SELECT 
	CATEGORY,
	SUM(PRICE) AS REVENUE
	FROM 
	BASE_ORDER
	GROUP BY 
	CATEGORY
)
SELECT * FROM CATEGORY_REVENUE ORDER BY CATEGORY;