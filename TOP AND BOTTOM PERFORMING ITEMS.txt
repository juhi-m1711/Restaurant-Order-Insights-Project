-- TOP AND BOTTOM PERFORMING ITEMS
-- 1. Top 5 best-selling items by REVENUE
WITH BASE_ORDER AS (
	SELECT
		OD.ORDER_DETAILS_ID,
		OD.ORDER_ID,
		OD.ORDER_DATE,
		OD.ORDER_TIME,
		OD.ITEM_ID,
		MI.MENU_ITEM_ID,
		MI.ITEM_NAME,
		MI.CATEGORY,
		MI.PRICE
	FROM 
	ORDER_DETAILS AS OD
	JOIN 
	MENU_ITEMS AS MI 
	ON
	OD.ITEM_ID = MI.MENU_ITEM_ID
),
ITEM_SALES AS (
	SELECT 
	ITEM_NAME,
	SUM(PRICE) AS REVENUE 
	FROM 
	BASE_ORDER
	GROUP BY ITEM_NAME
)
SELECT * 
FROM ITEM_SALES 
ORDER BY REVENUE DESC 
LIMIT 5 ;

-- 2. Top 5 best-selling items by quantity
WITH BASE_ORDER AS (
	SELECT
		OD.ORDER_DETAILS_ID,
		OD.ORDER_ID,
		OD.ORDER_DATE,
		OD.ORDER_TIME,
		OD.ITEM_ID,
		MI.MENU_ITEM_ID,
		MI.ITEM_NAME,
		MI.CATEGORY,
		MI.PRICE
	FROM 
	ORDER_DETAILS AS OD
	JOIN 
	MENU_ITEMS AS MI 
	ON
	OD.ITEM_ID = MI.MENU_ITEM_ID
),
ITEM_SALES AS (
	SELECT 
	ITEM_NAME,
	COUNT(*) AS QUANTITY
	FROM BASE_ORDER
	GROUP BY ITEM_NAME
)
SELECT * 
FROM ITEM_SALES 
ORDER BY QUANTITY DESC
LIMIT 5;

-- 3. Least Ordered Items
WITH BASE_ORDER AS (
	SELECT
		OD.ORDER_DETAILS_ID,
		OD.ORDER_ID,
		OD.ORDER_DATE,
		OD.ORDER_TIME,
		OD.ITEM_ID,
		MI.MENU_ITEM_ID,
		MI.ITEM_NAME,
		MI.CATEGORY,
		MI.PRICE
	FROM 
	ORDER_DETAILS AS OD
	JOIN 
	MENU_ITEMS AS MI 
	ON
	OD.ITEM_ID = MI.MENU_ITEM_ID
),
LEAST_ORDERED AS (
	SELECT 
	ITEM_NAME,
	COUNT(*) AS QUANTITY
	FROM BASE_ORDER
	GROUP BY ITEM_NAME
)
SELECT * 
FROM LEAST_ORDERED
ORDER BY QUANTITY ASC
LIMIT 5;